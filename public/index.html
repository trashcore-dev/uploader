<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéµ Music Downloader</title>
  <style>
    body {
      background: linear-gradient(180deg,#1E90FF,#1565c0);
      font-family: system-ui, sans-serif;
      color: white;
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .app {
      width: 90%;
      max-width: 700px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.25);
      backdrop-filter: blur(6px);
    }
    input[type=text] {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin-bottom: 15px;
      background: rgba(255,255,255,0.15);
      color: #fff;
      font-size: 15px;
      outline: none;
    }
    button {
      padding: 10px 15px;
      border-radius: 10px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .primary { background: white; color: #1E90FF; }
    .ghost { background: transparent; color: white; border: 1px solid rgba(255,255,255,0.4); }
    #status { margin: 10px 0; }
    #progressContainer {
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 6px;
      overflow: hidden;
      margin-top: 8px;
      display: none;
    }
    #progressBar {
      height: 8px;
      width: 0%;
      background: white;
      transition: width 0.2s linear;
    }
    #percent {
      margin-top: 5px;
      font-size: 13px;
      color: rgba(255,255,255,0.9);
      display: none;
    }
    audio { width:100%; margin-top:10px; border-radius:8px; display:none; }
    a { color:#fff; text-decoration:none; font-weight:bold; display:none; }
  </style>
</head>
<body>
  <div class="app">
    <h2>üé∂ Music Downloader</h2>
    <input id="queryInput" type="text" placeholder="Enter song name (e.g. Not Like Us)">
    <button id="searchBtn" class="primary">Search</button>
    <button id="clearBtn" class="ghost">Clear</button>
    <div id="status">Ready.</div>

    <div id="progressContainer">
      <div id="progressBar"></div>
    </div>
    <div id="percent">0%</div>

    <audio id="player" controls></audio>
    <a id="downloadLink" href="#" download>‚¨áÔ∏è Download MP3</a>
  </div>

  <script>
    const queryInput = document.getElementById('queryInput');
    const searchBtn = document.getElementById('searchBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const player = document.getElementById('player');
    const downloadLink = document.getElementById('downloadLink');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const percentText = document.getElementById('percent');

    let progressInterval;

    function startFakeProgress() {
      progressContainer.style.display = 'block';
      percentText.style.display = 'block';
      let p = 0;
      progressBar.style.width = '0%';
      percentText.textContent = '0%';
      progressInterval = setInterval(() => {
        if (p < 98) { // stop slightly below 100% until finished
          p += Math.random() * 2;
          progressBar.style.width = p.toFixed(0) + '%';
          percentText.textContent = p.toFixed(0) + '%';
        }
      }, 200);
    }

    function stopFakeProgress() {
      clearInterval(progressInterval);
      progressBar.style.width = '100%';
      percentText.textContent = '100%';
      setTimeout(() => {
        progressContainer.style.display = 'none';
        percentText.style.display = 'none';
      }, 500);
    }

    async function searchSong(query) {
      statusEl.textContent = 'üéß Searching...';
      player.style.display = 'none';
      downloadLink.style.display = 'none';
      startFakeProgress();
      try {
        const res = await fetch(`/play?query=${encodeURIComponent(query)}`);
        const data = await res.json();
        stopFakeProgress();
        if (data.downloadUrl) {
          statusEl.textContent = `‚úÖ Found: ${data.title}`;
          player.src = data.downloadUrl;
          player.style.display = 'block';
          downloadLink.href = data.downloadUrl;
          downloadLink.style.display = 'inline-block';
        } else {
          statusEl.textContent = '‚ùå Song not found or failed.';
        }
      } catch (e) {
        stopFakeProgress();
        statusEl.textContent = 'üí• Error: ' + e.message;
      }
    }

    searchBtn.onclick = () => {
      const q = queryInput.value.trim();
      if (!q) return;
      searchSong(q);
    };

    clearBtn.onclick = () => {
      queryInput.value = '';
      player.src = '';
      player.style.display = 'none';
      downloadLink.style.display = 'none';
      statusEl.textContent = 'Ready.';
      progressContainer.style.display = 'none';
      percentText.style.display = 'none';
      clearInterval(progressInterval);
    };
  </script>
</body>
</html>
